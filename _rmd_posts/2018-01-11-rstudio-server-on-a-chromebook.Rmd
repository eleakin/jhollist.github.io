---
layout: post
title: "RStudio Server on a Chromebook"
tags: ['chromeOS','Chromebook','crouton','xiwi','RStudio','RStudio Server']
categories: ['r']
---

The only post I got around to writing in 2017 was a single messy, evoloving set of notes on how to set up a Chromebook with R and RStudio.  This post is a reprise fo that one as well as post #1 in my effort to double my blog output from 2017 (I'm shooting for the stars on that one).  In this post I will detail how to set up RStudio Server in a crouton chroot and access it directly via Chrome without having to fire up a separate X11 window.

## Why RStudio Server?

I have been succesfully using RStudio Desktop on my Chromebook all year and it has worked great.  But there have been a few issues that have kind of bothered me.  The top four of these are: opening web pages from RStudio, opening documents (PDF or Word), overall look and feel, and (the big one) not being able to pull out a source tab into a separate window.  None of these are deal breakers, but they did lead to a bit of a bumpy workflow at times.  I did not have these problems when accessing RStudio Server in the browser, but I don't want to have pay for servers to host RStudio Server nor do I want to require an internet connection to work.  I figured I could stand up RStudio Server in a chroot, access it directly in Chrome via `localhost` and have a much more native feeling experience.

The long and short of it is that it is pretty easy to get set up (if you are comfortable setting using crouton) and the overall experience is much improved with web pages and documents just opening up in new tabs as you'd expect.  The biggest improvement is now I can pull out those source tabs into a stand along window and taken advantage of my new dual screen set-up.

![Pic of dual screen set up]()

So enough yammering, how do you do it?

## Install crouton and set up your chroot

There are a lot of great resources for installing crouton so no need for me to go over that again.  In particular take a look at [Jenny Bryan's notes](https://github.com/jennybc/operation-chromebook) and the [crouton repository](https://github.com/dnschneid/crouton)

For RStudio Server we don't need a full desktop so I decided to try this with a minimal install.  I chose core and cli-extra because, frankly, I didn't know the difference between the two and was just playing it safe.  You can choose to encrypt the chroot or not.  I didn't as I was playing around with auto-starting the chroot when Chrome OS starts ([see here for more on that](https://github.com/dnschneid/crouton/wiki/Autostart-crouton-chroot-at-ChromeOS-startup)).  Never got that part of it working right, but more on that later.

Anyway, here is what I used to get my chroot set up.

```
sudo sh ~/Downloads/crouton -t core,cli-extra -n rstudio
```

Once that finishes (it takes a while), you can hop into the chroot with

```
sudo enter-chroot

#or

sudo startcli
```

Again, I am not sure if there is a downside (or upside) for using one over the other.

## Install R

With a shiny new chroot started, we can now start all of our installs.  First one is R.

```
sudo echo "deb http://cran.rstudio.com/bin/linux/ubuntu xenial/" | sudo tee -a /etc/apt/sources.list
gpg --keyserver keyserver.ubuntu.com --recv-key E084DAB9
gpg -a --export E084DAB9 | sudo apt-key add -
sudo apt-get update
sudo apt-get install r-base r-base-dev
```

## Install RStudio Server

Next, we need to install RStudio Server.  This grabs the latest and greatest version as of January 2018.  I choose to delete the `.deb` just to keep the footprint of this thing to a minimum.  

```
sudo apt-get install gdebi-core
wget https://download2.rstudio.org/rstudio-server-1.1.383-amd64.deb
sudo gdebi rstudio-server-1.1.383-amd64.deb
rm rstudio-server-1.1.383-amd64.deb
```

## Open up firewall

Since this is RStudio server, we will be accessing it via Chrome and will need to make sure the requests get through the chroot's firewall.  We need to open that up to do so.  I include the `nano` install because it is a little easier to work with than `vim`.   

```
sudo apt-get install nano
sudo nano /etc/rc.local
```
Then add `/sbin/iptables -I INPUT -p tcp --dport 8787 -j` to the end of the file

## Get RStudio server running and access it

```
sudo rstudio-server start
```
Then in your browser you can access your RStudio Server with `localhost:8787`

## Draw the rest of f***ing owl

add ubuntugis
```
sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable
sudo apt-get update
```

```
sudo locale-gen "en_US.UTF-8"
sudo dpkg-reconfigure locales
sudo apt-get install software-properties-common
sudo apt-get install libxslt-dev libcurl4-openssl-dev libssl-dev
sudo apt-get update
sudo apt-get install libgdal-dev libproj-dev
sudo apt-get install libudunits2-dev
sudo apt-get install texlive texlive-latex-extra texlive-pictures
sudo apt-get install git
sudo apt-get install libssh2-1-dev
```
  
# Day to day use

There is a way to have your chroot automatically boot with Chrome OS and RStudio Server is supposed to start on boot.  For some reason, the server wasn't kicking off when I started up the chroot.  I didn't track this down so don't know if it will work.  Seems like with some hacking it should.  


So without everything starting automagicaly, the simplest solution is to:

- start up your chromebook
- open crosh - ctrl-alt-t
- type `shell`
- type `sudo startcli` or `sudo enter-chroot`
- type `sudo rstudio-server start`
- type `localhost:8787` into a broswer tab.

You will need to leave the tab your chroot is running in, otherwise it shuts down the chroot and your RStudio Server.

The first time I get RStudio open I want to install all my usual suspects.  With this set up I had no issues installing the following

```
pkgs <- c("devtools","tidyverse","sf","raster","mapview","sp","rgdal","rgeos","roxygen2", "blogdown")

lapply(pkgs, install.packages()
```

I then install my own packages, just so I have them handy, and then I configure git.  

```
git config --global user.name "Your Name"
git config --global user.email "your.email@email.com"
git config --global credential.helper 'cache --timeout=28800'
```

Lastly, the shutdown process is not super smooth on this (only problem I have identified so far).  When your chromebook sleeps, or you shut down the chroot, etc. The R sessions and RStudio get confused and I am no longer able to switch between projects.  It fails by just keeping you at your root.  If you don't use projects then this might not be an issue (but you do risk the [arsonistic ire of Jenny Bryan](https://www.tidyverse.org/articles/2017/12/workflow-vs-script/)).  If you do use projects this is a problem.  I did find a very simple workaround for when this happens.  All you need to do is start a new session.  This can be done with the little red power button icon in the upper right corner of the window or with File:Quit Session.

So, there you have it.  RStudio on a chromebook via RStudio Server running in a chroot!  I am now very happy with the set-up and fully expect to stick with the Chromebook for some time to come.
